# å†å²è®°å½•åŠŸèƒ½ - åç«¯ API éœ€æ±‚æ–‡æ¡£

## æ¦‚è¿°

å‰ç«¯ç›®å‰å°†å†å²è®°å½•å­˜å‚¨åœ¨ `localStorage`ï¼Œéœ€è¦è¿ç§»åˆ°åç«¯å®ç°æŒä¹…åŒ–å­˜å‚¨å’Œè·¨è®¾å¤‡åŒæ­¥ã€‚

## æ•°æ®æ¨¡å‹

### HistoryRecord (å†å²è®°å½•)

```typescript
interface HistoryRecord {
  id: string;                    // å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå»ºè®®ä½¿ç”¨ UUID
  user_id: string;              // æ‰€å±ç”¨æˆ· ID
  title: string;                // è®°å½•æ ‡é¢˜ï¼Œå¦‚ "æ‰«æè®°å½• Â· 2026-02-11 13:15:21"
  created_at: string;           // åˆ›å»ºæ—¶é—´ï¼ŒISO 8601 æ ¼å¼
  functions: string[];          // ä½¿ç”¨çš„åŠŸèƒ½åˆ—è¡¨ï¼Œå¦‚ ["scan", "polish", "citation"]
  input_text: string;           // åŸå§‹è¾“å…¥æ–‡æœ¬
  editor_html: string;          // å¯Œæ–‡æœ¬ç¼–è¾‘å™¨çš„ HTML å†…å®¹
  analysis: Analysis | null;    // åˆ†æç»“æœï¼ˆå¯é€‰ï¼‰
}
```

### Analysis (åˆ†æç»“æœ)

```typescript
interface Analysis {
  summary: Summary;             // æ‘˜è¦ç»Ÿè®¡
  sentences: Sentence[];        // å¥å­çº§åˆ«çš„åˆ†æç»“æœ
  translation: string;          // ç¿»è¯‘ç»“æœï¼ˆå¦‚æœä½¿ç”¨äº†ç¿»è¯‘åŠŸèƒ½ï¼‰
  polish: string;      // æ¶¦è‰²å»ºè®®ï¼ˆå¦‚æœä½¿ç”¨äº†æ¶¦è‰²åŠŸèƒ½ï¼‰
  citations: Citation[];        // å¼•ç”¨æ£€æµ‹ç»“æœï¼ˆå¦‚æœä½¿ç”¨äº†å¼•ç”¨åŠŸèƒ½ï¼‰
  ai_likely_count: number;      // AI ç”Ÿæˆå¯èƒ½æ€§é«˜çš„å¥å­æ•°é‡
  highlighted_html: string;     // é«˜äº®æ ‡æ³¨åçš„ HTML
}
```

### Summary (æ‘˜è¦ç»Ÿè®¡)

```typescript
interface Summary {
  ai: number;       // AI ç”Ÿæˆçš„ç™¾åˆ†æ¯” (0-100)
  mixed: number;    // æ··åˆå†…å®¹çš„ç™¾åˆ†æ¯” (0-100)
  human: number;    // äººå·¥æ’°å†™çš„ç™¾åˆ†æ¯” (0-100)
}
// æ³¨æ„ï¼šai + mixed + human åº”è¯¥ç­‰äº 100
```

### Sentence (å¥å­åˆ†æ)

```typescript
interface Sentence {
  id: string;           // å¥å­å”¯ä¸€æ ‡è¯†
  text: string;         // å¥å­æ–‡æœ¬å†…å®¹
  raw: string;          // åŸå§‹æ–‡æœ¬ï¼ˆåŒ…å«å¯èƒ½çš„å‰åç©ºæ ¼ï¼‰
  type: 'ai' | 'mixed' | 'human';  // åˆ†ç±»ç»“æœ
  probability: number;  // æ¦‚ç‡å€¼ (0-1)
  score: number;        // åˆ†æ•° (0-100)
  reason: string;       // åˆ¤æ–­ç†ç”±
  suggestion: string;   // æ”¹è¿›å»ºè®®
}
```

### Citation (å¼•ç”¨æ£€æµ‹)

```typescript
interface Citation {
  id: string;       // å¼•ç”¨å”¯ä¸€æ ‡è¯†
  text: string;     // å¼•ç”¨çš„æ–‡æœ¬ç‰‡æ®µ
  source: string;   // æ¥æºè¯´æ˜
}
```

## API ç«¯ç‚¹

### 1. è·å–å†å²è®°å½•åˆ—è¡¨

**ç«¯ç‚¹**: `GET /api/v1/history`

**æŸ¥è¯¢å‚æ•°**:
- `page` (å¯é€‰): é¡µç ï¼Œé»˜è®¤ 1
- `per_page` (å¯é€‰): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ 20ï¼Œæœ€å¤§ 100
- `sort` (å¯é€‰): æ’åºå­—æ®µï¼Œé»˜è®¤ `created_at`
- `order` (å¯é€‰): æ’åºæ–¹å‘ï¼Œ`asc` æˆ– `desc`ï¼Œé»˜è®¤ `desc`

**è¯·æ±‚å¤´**:
```
Authorization: Bearer <token>
```

**å“åº”** (200 OK):
```json
{
  "items": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "user_id": "user-123",
      "title": "æ‰«æè®°å½• Â· 2026-02-11 13:15:21",
      "created_at": "2026-02-11T13:15:21.000Z",
      "functions": ["scan"],
      "input_text": "The quick brown fox...",
      "editor_html": "<p>The quick brown fox...</p>",
      "analysis": {
        "summary": {
          "ai": 45,
          "mixed": 25,
          "human": 30
        },
        "sentences": [
          {
            "id": "sent-1",
            "text": "The quick brown fox jumps over the lazy dog.",
            "raw": "The quick brown fox jumps over the lazy dog.",
            "type": "ai",
            "probability": 0.85,
            "score": 85,
            "reason": "é«˜åº¦ç»“æ„åŒ–çš„è¡¨è¾¾æ–¹å¼",
            "suggestion": "å¯ä»¥ä½¿ç”¨æ›´åŠ å£è¯­åŒ–çš„è¡¨è¿°"
          }
        ],
        "translation": "",
        "polish": "",
        "citations": [],
        "ai_likely_count": 5,
        "highlighted_html": "<span class=\"bg-amber-100\">...</span>"
      }
    }
  ],
  "total": 50,
  "page": 1,
  "per_page": 20,
  "total_pages": 3
}
```

### 2. è·å–å•æ¡å†å²è®°å½•

**ç«¯ç‚¹**: `GET /api/v1/history/{history_id}`

**è·¯å¾„å‚æ•°**:
- `history_id`: å†å²è®°å½• ID

**è¯·æ±‚å¤´**:
```
Authorization: Bearer <token>
```

**å“åº”** (200 OK):
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "user_id": "user-123",
  "title": "æ‰«æè®°å½• Â· 2026-02-11 13:15:21",
  "created_at": "2026-02-11T13:15:21.000Z",
  "functions": ["scan", "polish"],
  "input_text": "...",
  "editor_html": "...",
  "analysis": { /* ... */ }
}
```

**é”™è¯¯å“åº”** (404 Not Found):
```json
{
  "error": "HISTORY_NOT_FOUND",
  "message": "å†å²è®°å½•ä¸å­˜åœ¨"
}
```

### 3. åˆ›å»ºå†å²è®°å½•

**ç«¯ç‚¹**: `POST /api/v1/history`

**è¯·æ±‚å¤´**:
```
Authorization: Bearer <token>
Content-Type: application/json
```

**è¯·æ±‚ä½“**:
```json
{
  "title": "æ‰«æè®°å½• Â· 2026-02-11 13:15:21",
  "functions": ["scan"],
  "input_text": "The quick brown fox...",
  "editor_html": "<p>The quick brown fox...</p>",
  "analysis": {
    "summary": {
      "ai": 45,
      "mixed": 25,
      "human": 30
    },
    "sentences": [ /* ... */ ],
    "translation": "",
    "polish": "",
    "citations": [],
    "ai_likely_count": 5,
    "highlighted_html": "..."
  }
}
```

**å“åº”** (201 Created):
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "user_id": "user-123",
  "title": "æ‰«æè®°å½• Â· 2026-02-11 13:15:21",
  "created_at": "2026-02-11T13:15:21.000Z",
  "functions": ["scan"],
  "input_text": "The quick brown fox...",
  "editor_html": "<p>The quick brown fox...</p>",
  "analysis": { /* ... */ }
}
```

### 4. æ›´æ–°å†å²è®°å½•

**ç«¯ç‚¹**: `PATCH /api/v1/history/{history_id}`

**è·¯å¾„å‚æ•°**:
- `history_id`: å†å²è®°å½• ID

**è¯·æ±‚å¤´**:
```
Authorization: Bearer <token>
Content-Type: application/json
```

**è¯·æ±‚ä½“** (æ‰€æœ‰å­—æ®µå‡å¯é€‰):
```json
{
  "title": "æ–°æ ‡é¢˜"
}
```

**å“åº”** (200 OK):
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "user_id": "user-123",
  "title": "æ–°æ ‡é¢˜",
  "created_at": "2026-02-11T13:15:21.000Z",
  "functions": ["scan"],
  "input_text": "...",
  "editor_html": "...",
  "analysis": { /* ... */ }
}
```

### 5. åˆ é™¤å†å²è®°å½•

**ç«¯ç‚¹**: `DELETE /api/v1/history/{history_id}`

**è·¯å¾„å‚æ•°**:
- `history_id`: å†å²è®°å½• ID

**è¯·æ±‚å¤´**:
```
Authorization: Bearer <token>
```

**å“åº”** (204 No Content):
```
(ç©ºå“åº”ä½“)
```

**é”™è¯¯å“åº”** (404 Not Found):
```json
{
  "error": "HISTORY_NOT_FOUND",
  "message": "å†å²è®°å½•ä¸å­˜åœ¨"
}
```

### 6. æ‰¹é‡åˆ é™¤å†å²è®°å½•

**ç«¯ç‚¹**: `POST /api/v1/history/batch-delete`

**è¯·æ±‚å¤´**:
```
Authorization: Bearer <token>
Content-Type: application/json
```

**è¯·æ±‚ä½“**:
```json
{
  "ids": [
    "550e8400-e29b-41d4-a716-446655440000",
    "660f9511-f3ac-52e5-b827-557766551111"
  ]
}
```

**å“åº”** (200 OK):
```json
{
  "deleted_count": 2,
  "failed_ids": []
}
```

### 7. æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•

**ç«¯ç‚¹**: `DELETE /api/v1/history`

**è¯·æ±‚å¤´**:
```
Authorization: Bearer <token>
```

**å“åº”** (200 OK):
```json
{
  "deleted_count": 50
}
```

## ä¸šåŠ¡é€»è¾‘è¦æ±‚

### 1. æƒé™æ§åˆ¶
- ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„å†å²è®°å½•
- æ¸¸å®¢ç”¨æˆ·ä¸åº”è¯¥æœ‰å†å²è®°å½•åŠŸèƒ½ï¼ˆæˆ–è€…ä½¿ç”¨ä¸´æ—¶å­˜å‚¨ï¼‰

### 2. æ•°æ®é™åˆ¶
- æ¯ä¸ªç”¨æˆ·æœ€å¤šä¿å­˜ **100** æ¡å†å²è®°å½•
- å½“è¾¾åˆ°ä¸Šé™æ—¶ï¼Œè‡ªåŠ¨åˆ é™¤æœ€æ—§çš„è®°å½•ï¼ˆæŒ‰ `created_at` æ’åºï¼‰
- å•æ¡è®°å½•çš„ `input_text` æœ€å¤§ **50,000** å­—ç¬¦

### 3. è‡ªåŠ¨ä¿å­˜
- **å»ºè®®åœ¨å‰ç«¯æ‰«æå®Œæˆåè‡ªåŠ¨åˆ›å»ºå†å²è®°å½•**
- ä¸éœ€è¦ç”¨æˆ·æ‰‹åŠ¨ä¿å­˜

### 4. å…³è”æ£€æµ‹ç»“æœ
- å†å²è®°å½•åº”è¯¥ä¿å­˜å®Œæ•´çš„ `analysis` æ•°æ®
- è¿™æ ·ç”¨æˆ·å¯ä»¥å›é¡¾ä¹‹å‰çš„æ£€æµ‹ç»“æœï¼Œæ— éœ€é‡æ–°æ£€æµ‹

### 5. æœç´¢å’Œè¿‡æ»¤ï¼ˆæœªæ¥æ‰©å±•ï¼‰
ä»¥ä¸‹åŠŸèƒ½å¯åœ¨åç»­ç‰ˆæœ¬å®ç°ï¼š
- æŒ‰æ ‡é¢˜æœç´¢
- æŒ‰æ—¶é—´èŒƒå›´è¿‡æ»¤
- æŒ‰åŠŸèƒ½ç±»å‹è¿‡æ»¤ï¼ˆscan/polish/citationï¼‰
- æŒ‰ AI æ£€æµ‹å¾—åˆ†è¿‡æ»¤

## æ•°æ®åº“è®¾è®¡å»ºè®®

### ä¸»è¡¨: `history_records`

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | UUID | ä¸»é”® | PRIMARY KEY |
| user_id | VARCHAR/UUID | ç”¨æˆ· ID | INDEX |
| title | VARCHAR(255) | æ ‡é¢˜ | |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | INDEX |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ | |
| functions | JSON/TEXT | åŠŸèƒ½åˆ—è¡¨ | |
| input_text | TEXT | è¾“å…¥æ–‡æœ¬ | |
| editor_html | TEXT | HTML å†…å®¹ | |
| analysis_data | JSON/TEXT | åˆ†æç»“æœ JSON | |

**ç´¢å¼•å»ºè®®**:
- `(user_id, created_at DESC)` - ç”¨äºåˆ—è¡¨æŸ¥è¯¢å’Œåˆ†é¡µ
- `(user_id, id)` - ç”¨äºå•æ¡æŸ¥è¯¢

## é”™è¯¯ç å®šä¹‰

| é”™è¯¯ç  | HTTP çŠ¶æ€ç  | è¯´æ˜ |
|--------|-------------|------|
| HISTORY_NOT_FOUND | 404 | å†å²è®°å½•ä¸å­˜åœ¨ |
| HISTORY_LIMIT_EXCEEDED | 400 | è¶…å‡ºå†å²è®°å½•æ•°é‡é™åˆ¶ |
| INVALID_HISTORY_DATA | 400 | æ— æ•ˆçš„å†å²è®°å½•æ•°æ® |
| UNAUTHORIZED | 401 | æœªæˆæƒè®¿é—® |
| FORBIDDEN | 403 | æ— æƒè®¿é—®è¯¥å†å²è®°å½• |

## è¿ç§»å»ºè®®

### é˜¶æ®µ 1: åç«¯ API å®ç°
1. å®ç°æ•°æ®åº“è¡¨ç»“æ„
2. å®ç°æ‰€æœ‰ CRUD æ¥å£
3. æ·»åŠ å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

### é˜¶æ®µ 2: å‰ç«¯è¿ç§»
1. å‰ç«¯æ·»åŠ  API è°ƒç”¨é€»è¾‘
2. å®ç°è‡ªåŠ¨åŒæ­¥æœºåˆ¶
3. è¿ç§»ç°æœ‰ localStorage æ•°æ®åˆ°åç«¯ï¼ˆå¯é€‰ï¼‰

### é˜¶æ®µ 3: ä¼˜åŒ–
1. æ·»åŠ æœç´¢å’Œè¿‡æ»¤åŠŸèƒ½
2. å®ç°åˆ†äº«å†å²è®°å½•åŠŸèƒ½
3. æ·»åŠ å¯¼å‡ºåŠŸèƒ½ï¼ˆPDF/Wordï¼‰

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®è¿ç§»**: å‰ç«¯ç°æœ‰çš„ localStorage æ•°æ®åœ¨ç”¨æˆ·ç™»å½•ååº”è¯¥è‡ªåŠ¨ä¸Šä¼ åˆ°åç«¯
2. **ç¦»çº¿æ”¯æŒ**: è€ƒè™‘æœªæ¥æ”¯æŒç¦»çº¿æ¨¡å¼ï¼Œå…è®¸åœ¨æ— ç½‘ç»œæ—¶ä½¿ç”¨ localStorage
3. **å®‰å…¨æ€§**: ç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„å†å²è®°å½•
4. **æ€§èƒ½**: å¯¹äºå¤§é‡å†å²è®°å½•ï¼Œè¦è€ƒè™‘åˆ†é¡µå’Œæ‡’åŠ è½½
5. **å­˜å‚¨æˆæœ¬**: `analysis_data` å¯èƒ½åŒ…å«å¤§é‡æ•°æ®ï¼Œè€ƒè™‘å‹ç¼©æˆ–åªä¿å­˜å…³é”®ä¿¡æ¯

---

# é˜¶æ®µä¸€å®Œæˆæ€»ç»“ï¼ˆåç«¯å®ç°ï¼‰

**å®Œæˆæ—¶é—´**: 2026-02-11  
**å®ç°æ–¹æ¡ˆ**: æ–¹æ¡ˆ1 - å¤ç”¨ `detections` è¡¨ä½œä¸ºå†å²è®°å½•è¡¨

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ•°æ®å­˜å‚¨
- **è¡¨ç»“æ„**: å¤ç”¨ç°æœ‰ `detections` è¡¨ï¼Œæ— éœ€æ•°æ®åº“è¿ç§»
- **å­—æ®µæ˜ å°„**:
  - `id` â†’ å†å²è®°å½• ID
  - `user_id` â†’ ç”¨æˆ·å…³è”
  - `title` â†’ è®°å½•æ ‡é¢˜
  - `created_at` â†’ åˆ›å»ºæ—¶é—´
  - `functions_used` â†’ åŠŸèƒ½åˆ—è¡¨ï¼ˆJSONï¼‰
  - `input_text` â†’ åŸå§‹è¾“å…¥
  - `editor_html` â†’ å¯Œæ–‡æœ¬HTML
  - `meta_json.analysis` â†’ å®Œæ•´åˆ†ææ•°æ®ï¼ˆJSONï¼‰

### 2. API ç«¯ç‚¹ï¼ˆ8ä¸ªï¼‰

æ‰€æœ‰ç«¯ç‚¹è·¯å¾„å‰ç¼€ï¼š`/api/v1/history`

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| `/history` | GET | è·å–å†å²è®°å½•åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰ | å¿…éœ€ |
| `/history/{id}` | GET | è·å–å•æ¡å†å²è®°å½• | å¿…éœ€ |
| `/history` | POST | åˆ›å»ºå†å²è®°å½• | å¿…éœ€ |
| `/history/{id}` | PATCH | æ›´æ–°å†å²è®°å½•ï¼ˆä»… titleï¼‰ | å¿…éœ€ |
| `/history/{id}` | DELETE | åˆ é™¤å•æ¡å†å²è®°å½• | å¿…éœ€ |
| `/history/batch-delete` | POST | æ‰¹é‡åˆ é™¤ | å¿…éœ€ |
| `/history` | DELETE | æ¸…ç©ºæ‰€æœ‰å†å²è®°å½• | å¿…éœ€ |

### 3. æ ¸å¿ƒåŠŸèƒ½

#### âœ… CRUD æ“ä½œ
- åˆ›å»ºã€è¯»å–ã€æ›´æ–°ï¼ˆtitleï¼‰ã€åˆ é™¤å†å²è®°å½•
- æ‰€æœ‰æ“ä½œéƒ½æœ‰ç”¨æˆ·æƒé™éªŒè¯

#### âœ… åˆ†é¡µä¸æ’åº
- æ”¯æŒ `page`ã€`per_page` å‚æ•°ï¼ˆæœ€å¤§ 100 æ¡/é¡µï¼‰
- æ”¯æŒ `sort`ï¼ˆå­—æ®µï¼‰ã€`order`ï¼ˆasc/descï¼‰å‚æ•°
- é»˜è®¤æŒ‰ `created_at` é™åºæ’åˆ—

#### âœ… æ‰¹é‡æ“ä½œ
- æ‰¹é‡åˆ é™¤ï¼šè¿”å›æˆåŠŸæ•°å’Œå¤±è´¥ ID åˆ—è¡¨
- æ¸…ç©ºæ‰€æœ‰ï¼šè¿”å›åˆ é™¤è®¡æ•°

#### âœ… 100 æ¡é™åˆ¶
- æ¯ä¸ªç”¨æˆ·æœ€å¤šä¿å­˜ 100 æ¡å†å²è®°å½•
- è¶…å‡ºæ—¶è‡ªåŠ¨åˆ é™¤æœ€æ—§è®°å½•ï¼ˆæŒ‰ `created_at` æ’åºï¼‰

#### âœ… æƒé™æ§åˆ¶
- ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„å†å²è®°å½•
- æ¸¸å®¢ç”¨æˆ·æ— æƒè®¿é—®å†å²è®°å½• API

### 4. æµ‹è¯•éªŒè¯

**æµ‹è¯•æ–‡ä»¶**: `backend/tests/test_history.py`  
**æµ‹è¯•ç”¨ä¾‹æ•°**: 11 ä¸ª  
**æµ‹è¯•çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡

æµ‹è¯•è¦†ç›–ï¼š
- [x] åˆ›å»ºå†å²è®°å½•
- [x] è·å–å†å²è®°å½•åˆ—è¡¨
- [x] åˆ†é¡µåŠŸèƒ½
- [x] è·å–å•æ¡è®°å½•
- [x] 404 é”™è¯¯å¤„ç†
- [x] æ›´æ–°è®°å½•
- [x] åˆ é™¤è®°å½•
- [x] æ‰¹é‡åˆ é™¤
- [x] æ¸…ç©ºæ‰€æœ‰
- [x] æƒé™éš”ç¦»
- [x] 100 æ¡é™åˆ¶

## ğŸ“– å‰ç«¯é›†æˆæŒ‡å—

### API è°ƒç”¨ç¤ºä¾‹

#### 1. åˆ›å»ºå†å²è®°å½•

```typescript
POST /api/v1/history
Authorization: Bearer <token>
Content-Type: application/json

{
  "title": "æ‰«æè®°å½• Â· 2026-02-11 13:15:21",
  "functions": ["scan"],
  "input_text": "Sample text...",
  "editor_html": "<p>Sample text...</p>",
  "analysis": {
    "summary": {
      "ai": 45,
      "mixed": 25,
      "human": 30
    },
    "sentences": [
      {
        "id": "sent-1",
        "text": "Sample sentence.",
        "raw": "Sample sentence.",
        "type": "ai",
        "probability": 0.85,
        "score": 85,
        "reason": "é«˜åº¦ç»“æ„åŒ–",
        "suggestion": "å¯ä»¥æ›´å£è¯­åŒ–"
      }
    ],
    "translation": "",
    "polish": "",
    "citations": [],
    "ai_likely_count": 5,
    "highlighted_html": "<span>...</span>"
  }
}

// å“åº” (201 Created)
{
  "id": 123,
  "user_id": 456,
  "title": "æ‰«æè®°å½• Â· 2026-02-11 13:15:21",
  "created_at": "2026-02-11T13:15:21.000Z",
  "functions": ["scan"],
  "input_text": "Sample text...",
  "editor_html": "<p>Sample text...</p>",
  "analysis": { /* ... */ }
}
```

#### 2. è·å–å†å²è®°å½•åˆ—è¡¨

```typescript
GET /api/v1/history?page=1&per_page=20&sort=created_at&order=desc
Authorization: Bearer <token>

// å“åº” (200 OK)
{
  "items": [
    {
      "id": 123,
      "user_id": 456,
      "title": "æ‰«æè®°å½• Â· 2026-02-11 13:15:21",
      "created_at": "2026-02-11T13:15:21.000Z",
      "functions": ["scan"],
      "input_text": "...",
      "editor_html": "...",
      "analysis": { /* ... */ }
    }
  ],
  "total": 50,
  "page": 1,
  "per_page": 20,
  "total_pages": 3
}
```

#### 3. è·å–å•æ¡å†å²è®°å½•

```typescript
GET /api/v1/history/123
Authorization: Bearer <token>

// å“åº” (200 OK)
{
  "id": 123,
  "user_id": 456,
  // ... å®Œæ•´è®°å½•æ•°æ®
}

// é”™è¯¯å“åº” (404 Not Found)
{
  "error": "HISTORY_NOT_FOUND",
  "message": "å†å²è®°å½•ä¸å­˜åœ¨"
}
```

#### 4. æ›´æ–°å†å²è®°å½•

```typescript
PATCH /api/v1/history/123
Authorization: Bearer <token>
Content-Type: application/json

{
  "title": "æ–°æ ‡é¢˜"
}

// å“åº” (200 OK) - è¿”å›æ›´æ–°åçš„å®Œæ•´è®°å½•
```

#### 5. åˆ é™¤å†å²è®°å½•

```typescript
DELETE /api/v1/history/123
Authorization: Bearer <token>

// å“åº” (204 No Content) - ç©ºå“åº”ä½“
```

#### 6. æ‰¹é‡åˆ é™¤

```typescript
POST /api/v1/history/batch-delete
Authorization: Bearer <token>
Content-Type: application/json

{
  "ids": [123, 456, 789]
}

// å“åº” (200 OK)
{
  "deleted_count": 3,
  "failed_ids": []
}
```

#### 7. æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•

```typescript
DELETE /api/v1/history
Authorization: Bearer <token>

// å“åº” (200 OK)
{
  "deleted_count": 50
}
```

## ğŸ”„ é˜¶æ®µäºŒä»»åŠ¡ï¼ˆå‰ç«¯å®ç°ï¼‰

### å¿…éœ€ä»»åŠ¡

1. **API é›†æˆ**
   - å®ç°æ‰€æœ‰ 7 ä¸ª API è°ƒç”¨å‡½æ•°
   - æ·»åŠ é”™è¯¯å¤„ç†å’Œé‡è¯•é€»è¾‘
   - å®ç° loading çŠ¶æ€ç®¡ç†

2. **è‡ªåŠ¨ä¿å­˜æœºåˆ¶**
   - åœ¨æ£€æµ‹å®Œæˆåè‡ªåŠ¨è°ƒç”¨ `POST /api/v1/history` ä¿å­˜è®°å½•
   - ä¿å­˜å®Œæ•´çš„ `analysis` æ•°æ®

3. **å†å²è®°å½•åˆ—è¡¨ç•Œé¢**
   - å®ç°åˆ†é¡µåˆ—è¡¨å±•ç¤º
   - æ”¯æŒæŒ‰æ—¶é—´æ’åº
   - å®ç°ä¸‹æ‹‰åˆ·æ–°/æ— é™æ»šåŠ¨

4. **å•æ¡è®°å½•æŸ¥çœ‹**
   - ç‚¹å‡»åˆ—è¡¨é¡¹æŸ¥çœ‹å®Œæ•´çš„æ£€æµ‹ç»“æœ
   - å¤ç”¨ç°æœ‰çš„æ£€æµ‹ç»“æœå±•ç¤ºç»„ä»¶

5. **è®°å½•ç®¡ç†åŠŸèƒ½**
   - é‡å‘½åè®°å½•ï¼ˆæ›´æ–° titleï¼‰
   - åˆ é™¤å•æ¡è®°å½•ï¼ˆå¸¦ç¡®è®¤æç¤ºï¼‰
   - æ‰¹é‡åˆ é™¤ï¼ˆå¤šé€‰ + æ‰¹é‡æ“ä½œï¼‰
   - æ¸…ç©ºæ‰€æœ‰è®°å½•ï¼ˆå¸¦äºŒæ¬¡ç¡®è®¤ï¼‰

### å¯é€‰ä»»åŠ¡

6. **localStorage è¿ç§»**ï¼ˆæ¨èï¼‰
   - åœ¨ç”¨æˆ·ç™»å½•åï¼Œæ£€æŸ¥ localStorage ä¸­çš„å†å²è®°å½•
   - è‡ªåŠ¨ä¸Šä¼ åˆ°åç«¯ï¼ˆå»é‡ï¼‰
   - è¿ç§»æˆåŠŸåæ¸…ç©º localStorage

7. **ç¦»çº¿æ”¯æŒ**ï¼ˆå¯é€‰ï¼‰
   - æ— ç½‘ç»œæ—¶ä»ç„¶ä½¿ç”¨ localStorage
   - æœ‰ç½‘ç»œæ—¶è‡ªåŠ¨åŒæ­¥åˆ°åç«¯
   - å®ç°å†²çªè§£å†³ç­–ç•¥

8. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
   - è®°å½•å¡ç‰‡æ˜¾ç¤ºåŠŸèƒ½å›¾æ ‡ï¼ˆscan/polish/citationï¼‰
   - æ˜¾ç¤º AI æ£€æµ‹å¾—åˆ†çš„å¯è§†åŒ–æ ‡ç­¾
   - å®ç°æœç´¢åŠŸèƒ½ï¼ˆå‰ç«¯è¿‡æ»¤æˆ–åç«¯æ‰©å±•ï¼‰

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **è®¤è¯**: æ‰€æœ‰ API è¯·æ±‚éƒ½éœ€è¦åœ¨ Header ä¸­æºå¸¦ `Authorization: Bearer <token>`
2. **é”™è¯¯å¤„ç†**: 
   - 401: æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ
   - 403: æ— æƒè®¿é—®ï¼Œæç¤ºé”™è¯¯
   - 404: è®°å½•ä¸å­˜åœ¨ï¼Œä»åˆ—è¡¨ä¸­ç§»é™¤
   - 429: è¯·æ±‚è¿‡å¤šï¼Œå®ç°é™æµæç¤º
3. **æ•°æ®éªŒè¯**:
   - `input_text` æœ€å¤§ 50,000 å­—ç¬¦
   - åˆ›å»ºæ—¶è‡ªåŠ¨è§¦å‘ 100 æ¡é™åˆ¶æ£€æŸ¥
4. **æ€§èƒ½ä¼˜åŒ–**:
   - åˆ—è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§é‡è®°å½•æ—¶ï¼‰
   - å›¾ç‰‡/å¤§æ•°æ®æ‡’åŠ è½½
   - å®ç°åˆ—è¡¨ç¼“å­˜æœºåˆ¶

## ğŸ¯ æ¨èå‰ç«¯æŠ€æœ¯æ ˆ

- **HTTP å®¢æˆ·ç«¯**: axios / fetch
- **çŠ¶æ€ç®¡ç†**: React Query / SWRï¼ˆæ¨èï¼Œè‡ªåŠ¨å¤„ç†ç¼“å­˜å’Œé‡æ–°éªŒè¯ï¼‰
- **UI ç»„ä»¶**: ç°æœ‰çš„ç»„ä»¶åº“
- **è™šæ‹Ÿæ»šåŠ¨**: react-virtual / react-windowï¼ˆå¯é€‰ï¼‰

## ğŸ“ åç«¯æ”¯æŒ

å¦‚æœ‰ä»»ä½• API ç›¸å…³é—®é¢˜ï¼Œè¯·è”ç³»åç«¯å›¢é˜Ÿã€‚åç«¯å·²å®Œæˆï¼š
- âœ… æ‰€æœ‰ API ç«¯ç‚¹
- âœ… å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- âœ… API æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹
- âœ… é”™è¯¯å¤„ç†å’Œæƒé™éªŒè¯
